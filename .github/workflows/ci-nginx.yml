name: CI - Nginx

on:
  pull_request:
    paths:
      - 'deploy/nginx/**'
      - '.github/workflows/ci-nginx.yml'

concurrency:
  group: ci-nginx-${{ github.head_ref }}
  cancel-in-progress: true

jobs:
  nginx-config-test:
    name: Nginx Config Test
    runs-on: ubuntu-latest
    steps:
      - uses: actions/checkout@v4
      - name: nginx -t
        run: |
          docker run --rm \
            --add-host api:127.0.0.1 \
            --add-host web:127.0.0.1 \
            -v "$PWD/deploy/nginx/nginx.conf:/etc/nginx/nginx.conf:ro" \
            -v "$PWD/deploy/nginx/sites-enabled:/etc/nginx/sites-enabled:ro" \
            nginx:1.25.4-alpine nginx -t
